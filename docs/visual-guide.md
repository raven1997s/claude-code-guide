# Claude Code 可视化学习指南

## 工作流程图

### 典型使用流程

```
┌─────────────────────────────────────────────────────────────────────┐
│                        Claude Code 使用流程                          │
└─────────────────────────────────────────────────────────────────────┘

     ┌─────────┐
     │  开始   │
     └────┬────┘
          │
          ▼
     ┌─────────────┐
     │ 选择启动方式 │
     └─────┬───────┘
           │
     ┌─────┴─────┬──────────────┬──────────────┐
     │           │              │              │
     ▼           ▼              ▼              ▼
┌─────────┐ ┌─────────┐  ┌──────────┐  ┌────────────┐
│交互模式 │ │打印模式  │  │继续对话   │  │恢复会话    │
│claude   │ │claude -p│  │claude -c │  │claude -r   │
└────┬────┘ └────┬────┘  └─────┬────┘  └─────┬──────┘
     │            │              │              │
     └────────┬───┴──────────────┴──────────────┘
              │
              ▼
     ┌─────────────────┐
     │   引用文件/内容   │
     │  @file.py:10-30  │
     │  #selection     │
     └────────┬─────────┘
              │
              ▼
     ┌─────────────────┐
     │  Claude 处理请求  │
     │  • 阅读文件      │
     │  • 分析代码      │
     │  • 执行工具      │
     └────────┬─────────┘
              │
              ▼
     ┌─────────────────┐
     │   输出结果       │
     │  • 代码修改      │
     │  • 解释说明      │
     │  • 执行结果      │
     └────────┬─────────┘
              │
              ▼
     ┌─────────────────┐
     │   满意吗？      │
     └────────┬─────────┘
          ┌───┴───┐
          │       │
         是       否
          │       │
          ▼       ▼
    ┌────────┐ ┌──────────┐
    │ /commit│ │ 继续提问  │
    │ 退出   │ │ 或 /clear│
    └────────┘ └──────────┘
```

### 文件引用语法

```
┌─────────────────────────────────────────────────────────────────┐
│                      文件引用语法                                │
└─────────────────────────────────────────────────────────────────┘

@ 符号引用:
┌──────────────────────────────────────────────────────────────┐
│ @file.py                 → 引用整个文件                       │
│ @file.py:10              → 引用第10行                         │
│ @file.py:10-30           → 引用第10-30行                      │
│ @file.py::50             → 引用前50行                         │
│ @file.py:100:            → 引用从第100行到结尾                │
│ @dir/                    → 引用整个目录                       │
│ @**/*.py                 → 通配符匹配                         │
└──────────────────────────────────────────────────────────────┘

# 符号引用:
┌──────────────────────────────────────────────────────────────┐
│ #selection              → IDE中选中的文本                     │
│ #function:name           → 引用函数                           │
│ #class:Name              → 引用类                             │
│ #variable:name           → 引用变量                           │
│ #symbol:module.show      → 引用符号定义                       │
└──────────────────────────────────────────────────────────────┘

组合使用:
┌──────────────────────────────────────────────────────────────┐
│ @file.py @file2.py       → 多文件引用                         │
│ @app.py:50-100 #selection → 文件范围 + IDE选择                │
└──────────────────────────────────────────────────────────────┘
```

### 权限流程

```
┌─────────────────────────────────────────────────────────────────┐
│                      权限处理流程                                │
└─────────────────────────────────────────────────────────────────┘

     ┌─────────────┐
     │ Claude 想要  │
     │ 执行操作     │
     └──────┬──────┘
            │
            ▼
     ┌───────────────────┐
     │ permission_mode?  │
     └─────┬─────┬──────┘
           │     │
    ┌──────┘     └──────┐
    │                   │
    ▼                   ▼
┌─────────┐       ┌────────────┐
│default  │       │acceptEdits │
│bypass   │       │dontAsk     │
└────┬────┘       └─────┬──────┘
     │                   │
     │                   ▼
     │            ┌───────────┐
     │            │ 自动执行   │
     │            └───────────┘
     │
     ▼
┌─────────────────┐
│  询问用户权限   │
└────────┬────────┘
         │
    ┌────┴────┬─────────┐
    │         │         │
    ▼         ▼         ▼
┌──────┐ ┌──────┐ ┌─────────┐
│Allow │ │Deny  │ │Always   │
└──┬───┘ └──┬───┘ └────┬────┘
   │        │         │
   ▼        ▼         ▼
┌─────┐ ┌─────┐ ┌─────────┐
│执行 │ │跳过 │ │记住选择 │
└─────┘ └─────┘ └─────────┘
```

### MCP 服务器架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    MCP 服务器集成                               │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┐      ┌──────────────────────────────────────┐
│ Claude Code  │──────│         MCP 服务器                    │
│              │      │  ┌─────────────────────────────────┐  │
│  - 会话管理   │      │  │ stdio (本地进程)                │  │
│  - 工具调用   │──────┼─│  • python -m server             │  │
│  - 响应处理   │      │  │  • npx @server                 │  │
│              │      │  └─────────────────────────────────┘  │
└──────────────┘      │                                      │
                      │  ┌─────────────────────────────────┐  │
                      │  │ HTTP (REST API)                 │  │
                      ├─│  • https://api.example.com/mcp   │  │
                      │  └─────────────────────────────────┘  │
                      │                                      │
                      │  ┌─────────────────────────────────┐  │
                      │  │ SSE (Server-Sent Events)        │  │
                      ├─│  • https://mcp.example.com/sse   │  │
                      │  └─────────────────────────────────┘  │
                      └──────────────────────────────────────┘

工具调用:
mcp__server_name__tool_name

示例:
mcp__filesystem__read_file
mcp__github__create_issue
mcp__database__query
```

### 插件系统

```
┌─────────────────────────────────────────────────────────────────┐
│                      插件架构                                    │
└─────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────┐
│                        插件容器                                  │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  plugin.json (清单)                                       │ │
│  │  - name, version, description                            │ │
│  │  - skills[], hooks[], permissions                        │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐    │
│  │  SKILL.md   │  │   Hooks/    │  │   Resources/        │    │
│  │  (核心逻辑)  │  │  (事件钩子)  │  │   (额外资源)        │    │
│  │             │  │             │  │                     │    │
│  │ ---         │  │ pre-tool    │  │ templates/          │    │
│  │ name: xxx   │  │ post-tool   │  │ examples/           │    │
│  │ description:│  │ session     │  │                     │    │
│  │ allowed:    │  │             │  │                     │    │
│  └─────────────┘  └─────────────┘  └─────────────────────┘    │
└────────────────────────────────────────────────────────────────┘

         │
         │  claude plugin install name
         ▼

┌────────────────────────────────────────────────────────────────┐
│                     Claude Code 主程序                          │
│                                                                  │
│   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│   │ 插件A    │  │ 插件B    │  │ 插件C    │  │   ...    │      │
│   │ enabled  │  │ disabled │  │ enabled  │  │          │      │
│   └──────────┘  └──────────┘  └──────────┘  └──────────┘      │
└────────────────────────────────────────────────────────────────┘
```

### 完整工作流示例

```
┌─────────────────────────────────────────────────────────────────┐
│                   代码审查工作流                                  │
└─────────────────────────────────────────────────────────────────┘

1️⃣ 启动会话
   ┌─────────────────────────────────────────┐
   │ claude --agent reviewer                 │
   │ └─ 使用代码审查 Agent                    │
   └─────────────────────────────────────────┘
           │
           ▼
2️⃣ 引用文件
   ┌─────────────────────────────────────────┐
   │ "审查 @src/auth.py 的代码质量"           │
   │ └─ @ 语法引用文件                        │
   └─────────────────────────────────────────┘
           │
           ▼
3️⃣ Claude 分析
   ┌─────────────────────────────────────────┐
   │ • Read 读取文件内容                      │
   │ • Grep 查找相关代码                      │
   │ • 分析代码质量                           │
   │ • 识别安全问题                           │
   └─────────────────────────────────────────┘
           │
           ▼
4️⃣ 输出报告
   ┌─────────────────────────────────────────┐
   │ ## 代码审查报告                          │
   │ ### 总体评估: 良好                       │
   │ ### 优点:                                │
   │   - 结构清晰                             │
   │ ### 需要改进:                            │
   │   - auth.py:45 缺少输入验证              │
   │   - 建议添加参数校验                      │
   └─────────────────────────────────────────┘
           │
           ▼
5️⃣ 修复问题
   ┌─────────────────────────────────────────┐
   │ "按建议修复 auth.py:45"                 │
   │ └─ Claude 自动修改代码                   │
   └─────────────────────────────────────────┘
           │
           ▼
6️⃣ 提交改动
   ┌─────────────────────────────────────────┐
   │ /commit                                 │
   │ └─ 自动分析并提交改动                    │
   └─────────────────────────────────────────┘
```

### 常见使用场景

```
┌─────────────────────────────────────────────────────────────────┐
│                    场景 - 快速修复 Bug                            │
└─────────────────────────────────────────────────────────────────┘

用户: "@app.py:200 这个错误是什么"

     │
     ▼
Claude: "让我查看相关代码..."
     │
     ├─ Read app.py:180-220
     ├─ 分析错误信息
     ├─ 查找相关依赖
     │
     ▼
"发现问题是空指针异常，建议添加检查"

     │
     ▼
用户: "帮我修复"

     │
     ▼
Claude: Edit app.py:200
     添加空值检查
     │
     ▼
用户: /commit
     │
     ▼
自动提交: "fix: resolve null pointer exception in app.py:200"
```
